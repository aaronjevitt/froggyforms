<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <title>Blank Form Render</title>
</head>
<body>
	<form id="fb-render"></form>
	<button type="button" id="submit-form">Submit Form</button>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
	<script src="https://formbuilder.online/assets/js/form-render.min.js"></script>
	<script>
		const submitFormBtn = document.getElementById("submit-form");
		submitFormBtn.addEventListener(
			"click",
			() => {
				if(validate() == true)
				{
					submit();
				}
				else
				{
					window.alert("Please fill in all required forms before submitting");
				}
			},
			false
		);
		
		const fbRender = document.getElementById("fb-render");
		const originalFormData = [
			{
				"type": "checkbox-group",
				"required": true,
				"label": "checko mehico",
				"name": "checkbox-group-1574027405290",
				"values": [
					{
						"label": "Option 1",
						"value": "option-1"
					},
					{
						"label": "Option 2",
						"value": "option-2"
					},
					{
						"label": "Option 3",
						"value": "option-3"
					}
				]
			},
			{
				"type": "date",
				"required": true,
				"label": "dato dato",
				"className": "form-control",
				"name": "date-1574029037726"
			},
			{
				"type": "file",
				"required": true,
				"label": "File Upload",
				"className": "form-control",
				"name": "file-1574027410621",
				"subtype": "file"
			},
			{
				"type": "number",
				"required": true,
				"label": "numero",
				"className": "form-control",
				"name": "number-1574028946834"
			},
			{
				"type": "radio-group",
				"required": true,
				"label": "rodeo radio",
				"name": "radio-group-1574029006581",
				"values": [
					{
						"label": "Option 1",
						"value": "option-1"
					},
					{
						"label": "Option 2",
						"value": "option-2"
					},
					{
						"label": "Option 3",
						"value": "option-3"
					}
				]
			},
			{
				"type": "select",
				"required": true,
				"label": "selecto mundo",
				"className": "form-control",
				"name": "select-1574027398028",
				"values": [
					{
						"label": "Option 1",
						"value": "option-1",
						"selected": true
					},
					{
						"label": "Option 2",
						"value": "option-2"
					},
					{
						"label": "Option 3",
						"value": "option-3"
					}
				]
			},
			{
				"type": "text",
				"required": true,
				"label": "texto t-trexto",
				"className": "form-control",
				"name": "text-1574027401302",
				"subtype": "text"
			},
			{
				"type": "textarea",
				"required": true,
				"label": "paragraphical interface",
				"className": "form-control",
				"name": "textarea-1574029133288",
				"subtype": "textarea"
			},
			{
				"type": "hidden",
				"name": "hidden-1574202434916"
			}
		];
		
		// Check that all required fields are filled out
		function validate()
		{
			var length = $(fbRender).formRender("userData").length;
			var i;
			for(i = 0; i < length; i++) // Go through each field
			{
				console.log($(fbRender).formRender("userData")[i]);
				if($(fbRender).formRender("userData")[i].required == true)
				{
					switch ($(fbRender).formRender("userData")[i].type)
					{
						case "checkbox-group":
							if(!$(fbRender).formRender("userData")[i].userData)
							{
								return false; // Maybe return type to fill out?
							}
							break;
						
						case "date":
							if(!$(fbRender).formRender("userData")[i].userData[0])
							{
								return false;
							}
							break;
						
						/* Can't implement currently - nothing stored
						case "file":
							break;
						*/
						
						case "number":
							if(!$(fbRender).formRender("userData")[i].userData[0])
							{
								return false;
							}
							break;
						
						case "radio-group":
							if(!$(fbRender).formRender("userData")[i].userData)
							{
								return false;
							}
							break;
						
						// Assuming use of default "select an option" option as option #1
						case "select":
							if($(fbRender).formRender("userData")[i].userData[0] 
								== $(fbRender).formRender("userData")[i].values[0].value)
							{
								return false;
							}
							break;
						
						
						case "text":
							if(!$(fbRender).formRender("userData")[i].userData[0])
							{
								return false;
							}
							break;
						
						case "textarea":
							if(!$(fbRender).formRender("userData")[i].userData[0])
							{
								return false;
							}
							break;
						
						/* Not yet implemented - not sure how hidden field works in form
						case "hidden":
							break;
						*/
						
						default:
							console.log("Non-implemented type");
							break;
					}
				}
			}
			
			return true;
		}
		
		function submit()
		{
			// Disable editing and fix file upload fields
			var froggyFile;
			var fileType;
			
			var length = $(fbRender).formRender("userData").length;
			var i;
			var j;
			for(i = 0; i < length; i++) // Go through each field
			{
				// Add preview/download to file upload fields
				if($(fbRender).formRender("userData")[i].type == "file")
				{
					froggyFile = document.getElementById($(fbRender).formRender("userData")[i].name);
					console.log(froggyFile);
					
					// Determine fileType
					for(j = 0; j < froggyFile.files[0].name.length; j++)
					{
						if(froggyFile.files[0].name[j] == ".") // will fail if more than one period
						{
							fileType = froggyFile.files[0].name.substr(j + 1);
							console.log(fileType);
						}
					}
					
					if(fileType == "txt" || fileType == "doc" || fileType == "docx" || fileType == "pdf") // Previewable file
					{	
						$(fbRender).formRender("userData")[i].label += '<br><iframe src="' + froggyFile.files[0].name + '" style="width:600px; height:500px;"frameborder="0"></iframe>';
					}
					else // Download-only file
					{
						$(fbRender).formRender("userData")[i].label += '<br><a href="' + froggyFile.files[0].name + '" target="_blank">Download File</a>';
					}
				}
				
				// Disable editing
				$(fbRender).formRender("userData")[i].disabled = true;
			}
			
			// "Submit" Placeholder
			window.alert(window.JSON.stringify($(fbRender).formRender("userData")));
		}
		
		jQuery(function($) {
			const formData = JSON.stringify(originalFormData);
			$(fbRender).formRender({formData});
		});
	</script>
</body>
</html>
